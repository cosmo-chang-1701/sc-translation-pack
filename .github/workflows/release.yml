name: Auto Release and Discord Notify

on:
  push:
    tags:
      - 'v*'

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    environment: Prod
    permissions:
      contents: write

    steps:
      - name: æª¢å‡ºå„²å­˜åº«ä»£ç¢¼
        uses: actions/checkout@v4

      - name: å–å¾—ç‰ˆæœ¬è™Ÿèˆ‡æ ¼å¼åŒ–æ—¥æœŸ
        id: vars
        run: |
          echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
          # è¨­å®šå°åŒ—æ™‚é–“ (UTC+8)
          echo "DATE=$(TZ='Asia/Taipei' date +'%Y-%m-%d %H:%M')" >> $GITHUB_OUTPUT

      - name: æ‰“åŒ…ç¿»è­¯æª” (ZIP)
        run: |
          # æ‰“åŒ…ç¹é«”ä¸­æ–‡è³‡æ–™å¤¾
          zip -r "sc-localization-zh-TW-${{ steps.vars.outputs.VERSION }}.zip" "./chinese_(traditional)/"

      - name: å»ºç«‹ GitHub Release
        id: create_release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ steps.vars.outputs.VERSION }}
          name: "Release ${{ steps.vars.outputs.VERSION }}"
          body: |
            ## æ˜Ÿéš›å…¬æ°‘ç¹é«”ä¸­æ–‡æ›´æ–°
            - **å°æ‡‰éŠæˆ²ç‰ˆæœ¬**: ${{ steps.vars.outputs.VERSION }}
            - **ç™¼å¸ƒæ—¥æœŸ**: ${{ steps.vars.outputs.DATE }} (å°åŒ—æ™‚é–“)
            
            *æ­¤ç‰ˆæœ¬ç”± GitHub Action è‡ªå‹•ç”Ÿæˆä¸¦æ‰“åŒ…ç™¼å¸ƒã€‚*
          files: |
            sc-localization-zh-TW-${{ steps.vars.outputs.VERSION }}.zip

      - name: Discord é€šçŸ¥
        uses: sarisia/actions-status-discord@v1
        if: success()
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
          content: "<@&${{ secrets.DISCORD_ROLE_ID }}>"
          title: "ğŸš€ æ˜Ÿéš›å…¬æ°‘ç¹ä¸­ç¿»è­¯æ›´æ–°ï¼š${{ steps.vars.outputs.VERSION }}"
          description: |
            æœ€æ–°çš„ç¹é«”ä¸­æ–‡ç¿»è­¯åŒ…å·²ç¶“ç™¼å¸ƒï¼
            
            ğŸ“… **ç™¼å¸ƒæ—¥æœŸ**: ${{ steps.vars.outputs.DATE }} (å°åŒ—æ™‚é–“)
            ğŸ“¦ **ç‰ˆæœ¬è™Ÿ**: ${{ steps.vars.outputs.VERSION }}
            
            [ğŸ‘‰ å‰å¾€ GitHub ä¸‹è¼‰æœ€æ–°ç¿»è­¯](https://github.com/${{ github.repository }}/releases/latest)
          color: 0x00ff00  # ç¶ è‰²
          username: "SC ç¿»è­¯ç™¼å¸ƒåŠ©æ‰‹"